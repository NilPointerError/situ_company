# JVM

<img src="C:\Users\Admin\Desktop\Java Notes\pic\242025553_1552556718666_11CD8DF4.jpg"  />

### 内存模型图

![image-20220810202359960](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220810202359960.png)

### 方法区

​	方法区是被所有线程所共享的内存区域，用来存储已被虚拟机加载的类信息、常量、静态变量、JIT编译后的代码等数据。运行时常量池是方法区的一部分，用于存放编译期间生成的各种字面常量和符号引用。

​	通过反射获取到的类型、方法名、字段名称、访问修饰符等信息就是从方法区获取到的。

### 堆

​	线程共享。所有的对象实例以及数组都要在堆上分配。回收器主要管理的对象。

​	它的目的是存放对象实例。同时它也是GC所管理的主要区域，因此常被称为GC堆，又由于现在收集器常使用分代算法，Java堆中还细分为新生代和老年代。

​	Java堆可以存在物理上不连续的内存空间，就像磁盘空间只要逻辑是连续的即可。它的内存大小可以设为固定大小，也可以扩展。

​	主流的虚拟机如HotPot都能按扩展实现(通过设置-Xmx和-Xms)，如果堆中没有内存，完成实力分配，而且堆无法扩展将报OOM错误

### 程序计数器

​	程序计数器是一块很小的内存空间，它是线程私有的，可以认作为当前线程的行号指示器。

​	为了线程切换可以恢复到正确执行位置，每个线程都需有独立的一个程序计数器，不同线程之间的程序计数器互不影响，独立存储。

### 虚拟机栈

​	为线程私有，生命周期与线程相同，就是我们平时说的栈，栈描述的是Java方法执行的内存模型。

​	每个方法被执行的时候都会创建一个栈帧用于存储局部变量表，操作栈，动态链接，方法出口等信息。每一个方法被调用的过程就对应一个栈帧在虚拟机栈中从入栈到出栈的过程。

### 本地方法栈(JVM执行本地方法)

​	本地方法栈与虚拟机栈发挥的作用十分相似，区别是虚拟机栈执行的是Java方法服务，二本地方法栈则为虚拟机使用到的native方法服务，可能底层调用的c或者c++，我们打开jdk安装目录可以看到也有很多用c编写的文件，可能就是native方法所调用的c代码。

​	动态链接：每个栈帧都保存了一个可以指向当前方法所在类的运行时常量池，目的是：当前方法中如果需要调用其他方法的时候，能够从运行时常量池中找到对应的符号引用，然后将符号引用转换为直接引用，然后就能直接调用对应方法，这就是动态链接

​	不是所有方法调用都需要动态链接的，有一部分符号引用会在类加载解析阶段，将符号引用转换为直接引用，这部分操作称之为静态解析。就是编译期间就能确定调用的版本，包括：调用静态方法，调用实例的私有构造器等。

### 垃圾回收(GC)

#### 判断对象已死

##### 引用计数算法

##### 可达性分析算法

#### 垃圾收集算法

##### 标记清除

##### 复制

##### 标记整理

##### 分代收集算法

#### 垃圾收集器

##### HotSpot这个虚拟机所包括的所有收集器

##### Serial收集器

##### ParNew收集器

##### Parallel Scavenge收集器

##### Serial Old收集器

##### Parallel Old收集器

##### CMS收集器

##### G1收集器

#### 分代收集相关概念

##### 内存分代划分

##### 新生代

##### 老年代

##### 永久代

#### Minor GC、Major GC和Full GC

### 类加载

#### 类的生命周期Class

##### 加载

##### 连接

验证、准备、解析

##### 初始化

##### 卸载

#### 类加载器

##### 分类

![image-20220811215443744](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20220811215443744.png)

###### 启动类加载器(BooStrap ClassLoader)

###### 扩展类加载器(Extension ClassLoader)

###### 系统类加载器(App ClassLoader)

###### 自定义的classLoader都必须继承自java.lang.ClassLoader类

##### java.lang.ClassLoader类

##### 类加载器的代理模式

双亲委托机制

### 引用类型

#### 强引用

#### 软引用

#### 弱引用

### Java对象的大小
